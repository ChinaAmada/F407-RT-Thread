

/* Includes ------------------------------------------------------------------*/
#include "config.h"

#define	ADS1_ENABLE			1
#define	ADS1_SPI			SPI3
#define	ADS1_CS				1
#define	ADS1_DRDY_PORT		GPIOD
#define	ADS1_DRDY_PIN		GPIO_Pin_4
#define	ADS1_DRDY_AHB		RCC_AHB1Periph_GPIOD
#define	ADS1_START_PORT		GPIOB
#define	ADS1_START_PIN		GPIO_Pin_3
#define	ADS1_START_AHB		RCC_AHB1Periph_GPIOB
#define	ADS1_RST_PORT		GPIOD
#define	ADS1_RST_PIN		GPIO_Pin_3
#define	ADS1_RST_AHB		RCC_AHB1Periph_GPIOD
#define	ADS1_SELECT0_PORT	GPIOE
#define	ADS1_SELECT0_PIN	GPIO_Pin_3
#define	ADS1_SELECT0_AHB	RCC_AHB1Periph_GPIOE
#define	ADS1_SELECT1_PORT	GPIOE
#define	ADS1_SELECT1_PIN	GPIO_Pin_4
#define	ADS1_SELECT1_AHB	RCC_AHB1Periph_GPIOE

#define ADS1_START_H		GPIO_SetBits(ADS1_START_PORT,ADS1_START_PIN)
#define ADS1_START_L		GPIO_ResetBits(ADS1_START_PORT,ADS1_START_PIN)
#define ADS1_RST_H			GPIO_SetBits(ADS1_RST_PORT,ADS1_RST_PIN)
#define ADS1_RST_L			GPIO_ResetBits(ADS1_RST_PORT,ADS1_RST_PIN)


#define	ADS2_ENABLE			1
#define	ADS2_SPI			SPI3
#define	ADS2_CS				2
#define	ADS2_DRDY_PORT		GPIOD
#define	ADS2_DRDY_PIN		GPIO_Pin_0
#define	ADS2_DRDY_AHB		RCC_AHB1Periph_GPIOD
#define	ADS2_START_PORT		GPIOD
#define	ADS2_START_PIN		GPIO_Pin_2
#define	ADS2_START_AHB		RCC_AHB1Periph_GPIOD
#define	ADS2_RST_PORT		GPIOA
#define	ADS2_RST_PIN		GPIO_Pin_15
#define	ADS2_RST_AHB		RCC_AHB1Periph_GPIOA
#define	ADS2_SELECT0_PORT	GPIOC
#define	ADS2_SELECT0_PIN	GPIO_Pin_9
#define	ADS2_SELECT0_AHB	RCC_AHB1Periph_GPIOC
#define	ADS2_SELECT1_PORT	GPIOA
#define	ADS2_SELECT1_PIN	GPIO_Pin_8
#define	ADS2_SELECT1_AHB	RCC_AHB1Periph_GPIOA

#define ADS2_START_H		GPIO_SetBits(ADS2_START_PORT,ADS2_START_PIN)
#define ADS2_START_L		GPIO_ResetBits(ADS2_START_PORT,ADS2_START_PIN)
#define ADS2_RST_H			GPIO_SetBits(ADS2_RST_PORT,ADS2_RST_PIN)
#define ADS2_RST_L			GPIO_ResetBits(ADS2_RST_PORT,ADS2_RST_PIN)



//pt1000 -20??100??? PT1000???
const float pt1000_table[]=
{
918.059,918.453,918.846,919.239,919.633,920.026,920.419,920.812,921.206,921.599,
921.992,922.385,922.779,923.172,923.565,923.958,924.351,924.745,925.138,925.531,
925.924,926.317,926.710,927.103,927.496,927.888,928.281,928.674,929.067,929.460,
929.853,930.246,930.639,931.032,931.425,931.818,932.211,932.604,932.997,933.390,
933.783,934.175,934.568,934.961,935.354,935.746,936.139,936.532,936.924,937.317,
937.710,938.102,938.495,938.888,939.281,939.673,940.066,940.459,940.851,941.244,
941.637,942.029,942.422,942.814,943.207,943.600,943.992,944.385,944.777,945.170,
945.562,945.955,946.347,946.740,947.132,947.524,947.917,948.309,948.702,949.094,
949.486,949.878,950.271,950.663,951.055,951.447,951.839,952.232,952.624,953.016,
953.408,953.800,954.193,954.585,954.977,955.369,955.761,956.154,956.546,956.938,
957.330,957.722,958.114,958.506,958.899,959.291,959.683,960.075,960.467,960.859,
961.251,961.643,962.035,962.427,962.819,963.211,963.603,963.995,964.387,964.779,
965.171,965.563,965.954,966.346,966.738,967.130,967.522,967.913,968.305,968.697,
969.089,969.480,969.872,970.264,970.656,971.047,971.439,971.831,972.222,972.614,
973.006,973.397,973.789,974.180,974.572,974.963,975.355,975.746,976.138,976.529,
976.921,977.313,977.704,978.096,978.487,978.879,979.270,979.662,980.053,980.444,
980.835,981.227,981.618,982.010,982.401,982.793,983.184,983.575,983.967,984.358,
984.749,985.140,985.532,985.923,986.314,986.705,987.096,987.488,987.879,988.270,
988.661,989.052,989.443,989.834,990.226,990.617,991.008,991.399,991.790,992.181,
992.572,992.963,993.354,993.745,994.136,994.527,994.918,995.309,995.700,996.091,
1000.000, 1000.391, 1000.782, 1001.172, 1001.563, 1001.954, 1002.345, 1002.736, 1003.126, 1003.517,
1003.908, 1004.298, 1004.689, 1005.080, 1005.470, 1005.861, 1006.252, 1006.642, 1007.033, 1007.424,
1007.814, 1008.205, 1008.595, 1008.986, 1009.377, 1009.767, 1010.158, 1010.548, 1010.939, 1011.329,
1011.720, 1012.110, 1012.501, 1012.891, 1013.282, 1013.672, 1014.062, 1014.453, 1014.843, 1015.234,
1015.624, 1016.014, 1016.405, 1016.795, 1017.185, 1017.576, 1017.966, 1018.356, 1018.747, 1019.137,
1019.527, 1019.917, 1020.308, 1020.698, 1021.088, 1021.478, 1021.868, 1022.259, 1022.649, 1023.039,
1023.429, 1023.819, 1024.209, 1024.599, 1024.989, 1025.380, 1025.770, 1026.160, 1026.550, 1026.940,
1027.330, 1027.720, 1028.110, 1028.500, 1028.890, 1029.280, 1029.670, 1030.060, 1030.450, 1030.840,
1031.229, 1031.619, 1032.009, 1032.399, 1032.789, 1033.179, 1033.569, 1033.958, 1034.348, 1034.738,
1035.128, 1035.518, 1035.907, 1036.297, 1036.687, 1037.077, 1037.466, 1037.856, 1038.246, 1038.636,
1039.025, 1039.415, 1039.805, 1040.194, 1040.584, 1040.973, 1041.363, 1041.753, 1042.142, 1042.532,
1042.921, 1043.311, 1043.701, 1044.090, 1044.480, 1044.869, 1045.259, 1045.648, 1046.038, 1046.427,
1046.816, 1047.206, 1047.595, 1047.985, 1048.374, 1048.764, 1049.153, 1049.542, 1049.932, 1050.321,
1050.710, 1051.100, 1051.489, 1051.878, 1052.268, 1052.657, 1053.046, 1053.435, 1053.825, 1054.214,
1054.603, 1054.992, 1055.381, 1055.771, 1056.160, 1056.549, 1056.938, 1057.327, 1057.716, 1058.105,
1058.495, 1058.884, 1059.273, 1059.662, 1060.051, 1060.440, 1060.829, 1061.218, 1061.607, 1061.996,
1062.385, 1062.774, 1063.163, 1063.552, 1063.941, 1064.330, 1064.719, 1065.108, 1065.496, 1065.885,
1066.274, 1066.663, 1067.052, 1067.441, 1067.830, 1068.218, 1068.607, 1068.996, 1069.385, 1069.774,
1070.162, 1070.551, 1070.940, 1071.328, 1071.717, 1072.106, 1072.495, 1072.883, 1073.272, 1073.661,
1074.049, 1074.438, 1074.826, 1075.215, 1075.604, 1075.992, 1076.381, 1076.769, 1077.158, 1077.546,
1077.935, 1078.324, 1078.712, 1079.101, 1079.489, 1079.877, 1080.266, 1080.654, 1081.043, 1081.431,
1081.820, 1082.208, 1082.596 ,1082.985, 1083.373, 1083.762, 1084.150, 1084.538, 1084.926, 1085.315, 
1085.703, 1086.091, 1086.480, 1086.868, 1087.256, 1087.644, 1088.033, 1088.421, 1088.809, 1089.197,
1089.585, 1089.974, 1090.362, 1090.750, 1091.138, 1091.526, 1091.914, 1092.302, 1092.690, 1093.078,
1093.467, 1093.855, 1094.243, 1094.631, 1095.019, 1095.407, 1095.795, 1096.183, 1096.571, 1096.959,
1097.347, 1097.734, 1098.122, 1098.510, 1098.898, 1099.286, 1099.674, 1100.062, 1100.450, 1100.838,
1101.225, 1101.613, 1102.001, 1102.389, 1102.777, 1103.164, 1103.552, 1103.940, 1104.328, 1104.715,
1105.103, 1105.491, 1105.879, 1106.266, 1106.654, 1107.042, 1107.429, 1107.817, 1108.204, 1108.592,
1108.980, 1109.367, 1109.755, 1110.142, 1110.530, 1110.917, 1111.305, 1111.693, 1112.080, 1112.468,
1112.855, 1113.242, 1113.630, 1114.017, 1114.405, 1114.792, 1115.180, 1115.567, 1115.954, 1116.342,
1116.729, 1117.117, 1117.504, 1117.891, 1118.279, 1118.666, 1119.053, 1119.441, 1119.828, 1120.215,
1120.602, 1120.990, 1121.377, 1121.764, 1122.151, 1122.538, 1122.926, 1123.313, 1123.700, 1124.087,
1124.474, 1124.861, 1125.248, 1125.636, 1126.023, 1126.410, 1126.797, 1127.184, 1127.571, 1127.958,
1128.345, 1128.732, 1129.119, 1129.506, 1129.893, 1130.280, 1130.667, 1131.054 ,1131.441, 1131.828,
1132.215, 1132.602, 1132.988, 1133.375, 1133.762, 1134.149, 1134.536, 1134.923, 1135.309, 1135.696,
1136.083, 1136.470, 1136.857, 1137.243, 1137.630, 1138.017, 1138.404, 1138.790, 1139.177, 1139.564,
1139.950, 1140.337, 1140.724, 1141.110, 1141.497, 1141.884, 1142.270, 1142.657, 1143.043, 1143.430,
1143.817, 1144.203, 1144.590, 1144.976, 1145.363, 1145.749, 1146.136, 1146.522, 1146.909, 1147.295,
1147.681, 1148.068, 1148.454, 1148.841, 1149.227, 1149.614, 1150.000, 1150.386, 1150.773, 1151.159,
1151.545, 1151.932, 1152.318, 1152.704, 1153.091, 1153.477, 1153.863, 1154.249, 1154.636, 1155.022,
1155.408, 1155.794, 1156.180, 1156.567, 1156.953, 1157.339, 1157.725, 1158.111, 1158.497, 1158.883,
1159.270, 1159.656, 1160.042, 1160.428, 1160.814, 1161.200, 1161.586, 1161.972, 1162.358, 1162.744,
1163.130, 1163.516, 1163.902, 1164.288, 1164.674, 1165.060, 1165.446, 1165.831, 1166.217, 1166.603,
1166.989, 1167.375, 1167.761, 1168.147, 1168.532, 1168.918, 1169.304, 1169.690, 1170.076, 1170.461,
1170.847, 1171.233, 1171.619, 1172.004, 1172.390, 1172.776, 1173.161, 1173.547, 1173.933, 1174.318,
1174.704, 1175.090, 1175.475, 1175.861, 1176.247, 1176.632, 1177.018, 1177.403, 1177.789, 1178.174,
1178.560, 1178.945, 1179.331, 1179.716, 1180.102, 1180.487, 1180.873, 1181.258, 1181.644, 1182.029,
1182.414, 1182.800, 1183.185, 1183.571, 1183.956, 1184.341, 1184.727, 1185.112, 1185.597, 1185.883,
1186.268, 1186.653, 1187.038, 1187.424, 1187.809, 1188.194, 1188.579, 1188.965, 1189.350, 1189.735,
1190.120, 1190.505, 1190.890, 1191.276, 1191.661, 1192.046, 1192.431, 1192.816, 1193.201, 1193.586,
1193.971, 1194.356, 1194.741, 1195.126, 1195.511, 1195.896, 1196.281, 1196.666, 1197.051, 1197.436,
1197.821, 1198.206, 1198.591, 1198.976, 1199.361, 1199.746, 1200.131, 1200.516, 1200.900, 1201.285,
1201.670, 1202.055, 1202.440, 1202.824, 1203.209, 1203.594, 1203.979, 1204.364, 1204.748, 1205.133,
1205.518, 1205.902, 1206.287, 1206.672, 1207.056, 1207.441, 1207.826, 1208.210, 1208.595, 1208.980,
1209.364, 1209.749, 1210.133, 1210.518, 1210.902, 1211.287, 1211.672, 1212.056, 1212.441, 1212.825,
1213.210, 1213.594, 1213.978, 1214.363, 1214.747, 1215.120, 1215.516, 1215.901, 1216.285, 1216.669,
1217.054, 1217.438, 1217.822, 1218.207, 1218.591, 1218.975, 1219.360, 1219.744, 1220.128, 1220.513,
1220.897, 1221.281, 1221.665, 1222.049, 1222.434, 1222.818, 1223.202, 1223.586, 1223.970, 1224.355,
1224.739, 1225.123, 1225.507, 1225.891, 1226.275, 1226.659, 1227.043, 1227.427, 1227.811, 1228.195,
1228.579, 1228.963, 1229.347, 1229.731, 1230.115, 1230.499, 1230.883, 1231.267, 1231.651, 1232.035,
1232.419, 1232.803, 1233.187, 1233.571, 1233.955, 1234.338, 1234.722, 1235.106, 1235.490, 1235.874,
1236.257, 1236.641, 1237.025, 1237.409, 1237.792, 1238.176, 1238.560, 1238.944, 1239.327, 1239.711,
1240.095, 1240.478, 1240.862, 1241.246, 1241.629, 1242.030, 1242.396, 1242.780, 1243.164, 1243.547,
1243.931, 1244.314, 1244.698, 1245.081, 1245.465, 1245.848, 1246.232, 1246.615, 1246.999, 1247.382,
1247.766, 1248.149, 1248.533, 1248.916, 1249.299, 1249.683, 1250.066, 1250.450, 1250.833, 1251.216,
1251.600, 1251.983, 1252.366, 1252.749, 1253.133, 1253.516, 1253.899, 1254.283, 1254.666, 1255.049,
1255.432, 1255.815, 1256.199, 1256.582, 1256.965, 1257.348, 1257.731, 1258.114, 1258.497, 1258.881,
1259.264, 1259.647, 1260.030, 1260.413, 1260.796, 1261.179, 1261.562, 1261.945, 1262.328, 1262.711,
1263.094, 1263.477, 1263.860, 1264.243, 1264.626, 1265.009, 1265.392, 1265.775, 1266.157, 1266.540,
1266.923, 1267.306, 1267.689, 1268.072, 1268.455, 1268.837, 1269.220, 1269.603, 1269.986, 1270.368,
1270.751, 1271.134, 1271.517, 1271.899, 1272.282, 1272.665, 1273.048, 1273.430, 1273.813, 1274.195,
1274.578, 1274.691, 1274.803, 1274.916, 1275.029, 1275.141, 1275.254, 1275.366, 1275.479, 1275.591,
1278.404, 1278.786, 1279.169, 1279.551, 1279.934, 1280.316, 1280.699, 1281.081, 1281.464, 1281.846,
1282.228, 1282.611, 1282.993, 1283.376, 1283.758, 1284.140, 1284.523, 1284.905, 1285.287, 1285.670,
1286.052, 1286.434, 1286.816, 1287.199, 1287.581, 1287.963, 1288.345, 1288.728, 1289.110, 1289.492,
1289.874, 1290.256, 1290.638, 1291.021, 1291.403, 1291.785, 1292.167, 1292.549, 1292.931, 1293.313,
1293.695, 1294.077, 1294.459, 1294.841, 1295.223, 1295.605, 1295.987, 1296.369, 1296.751, 1297.133,
1297.515, 1297.897, 1298.279, 1298.661, 1299.043, 1299.425, 1299.807, 1300.188, 1300.570, 1300.952,
1301.334, 1301.716, 1302.098, 1302.479, 1302.861, 1303.243, 1303.625, 1304.006, 1304.388, 1304.770,
1305.152, 1305.533, 1305.915, 1306.297, 1306.678, 1307.060, 1307.442, 1307.823, 1308.205, 1308.586,
1308.968, 1309.350, 1309.731, 1310.113, 1310.494, 1310.876, 1311.270, 1311.639, 1312.020, 1312.402,
1312.783, 1313.165, 1313.546, 1313.928, 1314.309, 1314.691, 1315.072, 1315.453, 1315.835, 1316.216,
1316.597, 1316.979, 1317.360, 1317.742, 1318.123, 1318.504, 1318.885, 1319.267, 1319.648, 1320.029,
1320.411, 1320.792, 1321.173, 1321.554, 1321.935, 1322.316, 1322.697, 1323.079, 1323.460, 1323.841,
1324.222, 1324.603, 1324.985, 1325.366, 1325.747, 1326.128, 1326.509, 1326.890, 1327.271, 1327.652,
1328.033, 1328.414, 1328.795, 1329.176, 1329.557, 1329.938, 1330.319, 1330.700, 1331.081, 1331.462,
1331.843, 1332.224, 1332.604, 1332.985, 1333.366, 1333.747, 1334.128, 1334.509, 1334.889, 1335.270,
1335.651, 1336.032, 1336.413, 1336.793, 1337.174, 1337.555, 1337.935, 1338.316, 1338.697, 1339.078,
1339.458, 1339.839, 1340.220, 1340.600, 1340.981, 1341.361, 1341.742, 1342.123, 1342.503, 1342.884,
1343.264, 1343.645, 1344.025, 1344.406, 1344.786, 1345.167, 1345.570, 1345.928, 1346.308, 1346.689,
1347.069, 1347.450, 1347.830, 1348.211, 1348.591, 1348.971, 1349.352, 1349.732, 1350.112, 1350.493,
1350.873, 1351.253, 1351.634, 1352.014, 1352.394, 1352.774, 1353.155, 1353.535, 1353.915, 1354.295,
1354.676, 1355.056, 1355.436, 1355.816, 1356.196, 1356.577, 1356.957, 1357.337, 1357.717, 1358.097,
1358.477, 1358.857, 1359.237, 1359.617, 1359.997, 1360.377, 1360.757, 1361.137, 1361.517, 1361.897,
1362.277, 1362.657, 1363.037, 1363.417, 1363.797, 1364.177, 1364.557, 1364.937, 1365.317, 1365.697,
1366.077, 1366.456, 1366.836, 1367.216, 1367.596, 1367.976, 1368.355, 1368.735, 1369.115, 1369.495,
1369.875, 1370.254, 1370.634, 1371.014, 1371.393, 1371.773, 1372.153, 1372.532, 1372.912, 1373.292,
1373.671, 1374.051, 1374.431, 1374.810, 1375.190, 1375.569, 1375.949, 1376.329, 1376.708, 1377.088,
1377.467, 1377.847, 1378.226, 1378.606, 1378.985, 1379.365, 1379.744, 1380.123, 1380.503, 1380.882,
1381.262, 1381.641, 1382.020, 1382.400, 1382.779, 1383.158, 1383.538, 1383.917, 1384.296, 1384.676,
1385.055
};











/*毫秒延时*/
void Ads_Delay(unsigned int ms)
{
	/*用户实现，根据用户系统实现*/
	rt_thread_mdelay(ms);
}


void Ads_Reset(unsigned char ADSx)
{
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
		GPIO_ResetBits(ADS1_RST_PORT, ADS1_RST_PIN);
		Ads_Delay(100);
		GPIO_SetBits(ADS1_RST_PORT, ADS1_RST_PIN);
		Ads_Delay(10);
#endif
	}else if(ADSx==2)
	{
#if(ADS2_ENABLE==1)
		GPIO_ResetBits(ADS2_RST_PORT, ADS2_RST_PIN);
		Ads_Delay(100);
		GPIO_SetBits(ADS2_RST_PORT, ADS2_RST_PIN);
		Ads_Delay(10);
#endif
	}
	
}

void ADS_Start(unsigned char ADSx)
{
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
	GPIO_SetBits(ADS1_START_PORT,ADS1_START_PIN);
#endif
	}else if(ADSx==2)
	{
#if(ADS2_ENABLE==1)
	GPIO_SetBits(ADS2_START_PORT,ADS2_START_PIN);
#endif
	}
	
}


void ADS_Write_Reg(unsigned char ADSx,unsigned char addr,unsigned char data)
{
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
		//SPI_Soft_CS_Enable(ADS1_SPI,ADS1_CS);
		//rt_thread_delay(100);
		
		SPI_transmit(ADS1_SPI,ADS1248_CMD_WREG+(addr & 0xF));
		SPI_transmit(ADS1_SPI,0);
		SPI_transmit(ADS1_SPI,data);
		
		//rt_thread_delay(100);
		//SPI_Soft_CS_Disable(ADS1_SPI,ADS1_CS);
#endif
	}else if(ADSx==2)
	{
#if(ADS2_ENABLE==1)
		SPI_transmit(ADS2_SPI,ADS1248_CMD_WREG+(addr & 0xF));
		SPI_transmit(ADS2_SPI,0);
		SPI_transmit(ADS2_SPI,data);
#endif
	}
}

unsigned char ADS1248_ReadByte(unsigned char ADSx)
{
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
		return (SPI_transmit(ADS1_SPI,ADS1248_CMD_NOP));
#endif		
	}else if(ADSx==2)
	{
#if(ADS2_ENABLE==1)
		return (SPI_transmit(ADS2_SPI,ADS1248_CMD_NOP));
#endif		
	}
    return 0;
}

unsigned char ADS_Read_Reg(unsigned char ADSx,unsigned char addr)
{
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
		SPI_transmit(ADS1_SPI,ADS1248_CMD_RREG+(addr & 0xF));
		SPI_transmit(ADS1_SPI,0);
		return ADS1248_ReadByte(ADSx);
#endif
	}else if(ADSx==2)
	{
#if(ADS2_ENABLE==1)
		SPI_transmit(ADS2_SPI,ADS1248_CMD_RREG+(addr & 0xF));
		SPI_transmit(ADS2_SPI,0);
		return ADS1248_ReadByte(ADSx);
#endif
	}
	return 0;
}



void ADS_Select_Channel(unsigned char ADSx,unsigned char ch)
{
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
		switch(ch){
			case 1:
				GPIO_ResetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_ResetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x3E); 
				Ads_Delay(10);		
				break;
			case 2:
				GPIO_SetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_ResetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x2C); 
				Ads_Delay(10);
				break;
			case 3:
				GPIO_ResetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_SetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x08); 
				Ads_Delay(10);
				break;
			case 4:
				GPIO_SetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_SetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x1A); 
				Ads_Delay(10);
				break;
			default:
				break;
		}
#endif	
	}else if(ADSx==2)
	{
#if(ADS1_ENABLE==1)
		switch(ch){
			case 1:
				GPIO_ResetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_ResetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x3E); 
				Ads_Delay(10);		
				break;
			case 2:
				GPIO_SetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_ResetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x2C); 
				Ads_Delay(10);
				break;
			case 3:
				GPIO_ResetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_SetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x08); 
				Ads_Delay(10);
				break;
			case 4:
				GPIO_SetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_SetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x1A); 
				Ads_Delay(10);
				break;
			default:
				break;
		}
#endif	
	}
}



void Ads_Init(unsigned char ADSx)
{
	unsigned char reg_val;
	GPIO_InitTypeDef GPIO_InitStructure;
	
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)
		RCC_AHB1PeriphClockCmd(ADS1_DRDY_AHB|ADS1_START_AHB|ADS1_RST_AHB|ADS1_SELECT0_AHB|ADS1_SELECT1_AHB, ENABLE);	
				
		
		//DRDY init
		GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
		GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
		GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
		GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
		GPIO_InitStructure.GPIO_Pin = ADS1_DRDY_PIN; 
		GPIO_Init(ADS1_DRDY_PORT, &GPIO_InitStructure);
		
		//START init
		GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;
		GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
		GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
		GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
		GPIO_InitStructure.GPIO_Pin = ADS1_START_PIN; 
		GPIO_Init(ADS1_START_PORT, &GPIO_InitStructure);
		//RST init
		GPIO_InitStructure.GPIO_Pin = ADS1_RST_PIN; 
		GPIO_Init(ADS1_RST_PORT, &GPIO_InitStructure);
		//SELECT0 init
		GPIO_InitStructure.GPIO_Pin = ADS1_SELECT0_PIN; 
		GPIO_Init(ADS1_SELECT0_PORT, &GPIO_InitStructure);
		//SELECT1 init
		GPIO_InitStructure.GPIO_Pin = ADS1_SELECT1_PIN; 
		GPIO_Init(ADS1_SELECT1_PORT, &GPIO_InitStructure);
		
		
		ADS1_RST_L;
		ADS1_START_L;
		Ads_Delay(4);
		ADS1_RST_H;
		ADS1_START_H;
		Ads_Delay(20);
		SPI_Soft_CS_Enable(ADS1_SPI,ADS1_CS);	//CS使能

		SPI_transmit(ADS1_SPI,ADS1248_CMD_RESET);
		
		Ads_Delay(100);
		
		ADS_Write_Reg(ADSx,ADS1248_REG_MUX1,0x30); 
		ADS_Write_Reg(ADSx,ADS1248_REG_VBIAS,0x00);
		ADS_Write_Reg(ADSx,ADS1248_REG_IDAC1,0x89);
		ADS_Write_Reg(ADSx,ADS1248_REG_IDAC0,0x0A);
		ADS_Write_Reg(ADSx,ADS1248_REG_SYS0,0x32);
		
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_MUX1);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_VBIAS);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_IDAC1);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_IDAC0);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_SYS0);
		reg_val=reg_val;
		
		SPI_Soft_CS_Disable(ADS1_SPI,ADS1_CS);	//CS不使能
		
#endif	
	}
	
	if(ADSx==2)
	{
#if(ADS2_ENABLE==1)
		RCC_AHB1PeriphClockCmd(ADS2_DRDY_AHB|ADS2_START_AHB|ADS2_RST_AHB|ADS2_SELECT0_AHB|ADS2_SELECT1_AHB, ENABLE);	
				
		//DRDY init
		GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;
		GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
		GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
		GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
		GPIO_InitStructure.GPIO_Pin = ADS2_DRDY_PIN; 
		GPIO_Init(ADS2_DRDY_PORT, &GPIO_InitStructure);
		
		//START init
		GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;
		GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;
		GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;
		GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;
		GPIO_InitStructure.GPIO_Pin = ADS2_START_PIN; 
		GPIO_Init(ADS2_START_PORT, &GPIO_InitStructure);
		//RST init
		GPIO_InitStructure.GPIO_Pin = ADS2_RST_PIN; 
		GPIO_Init(ADS2_RST_PORT, &GPIO_InitStructure);
		//SELECT0 init
		GPIO_InitStructure.GPIO_Pin = ADS2_SELECT0_PIN; 
		GPIO_Init(ADS2_SELECT0_PORT, &GPIO_InitStructure);
		//SELECT1 init
		GPIO_InitStructure.GPIO_Pin = ADS2_SELECT1_PIN; 
		GPIO_Init(ADS2_SELECT1_PORT, &GPIO_InitStructure);
		
		
		ADS2_RST_L;
		ADS2_START_L;
		Ads_Delay(4);
		ADS2_RST_H;
		ADS2_START_H;
		Ads_Delay(20);
		SPI_Soft_CS_Enable(ADS2_SPI,ADS2_CS);	//CS使能
		/*
		ADS_Write_Reg(ADSx,ADS2248_REG_MUX0,0x09); 	
		Ads_Delay(100);
		
		reg_val = ADS_Read_Reg(ADSx,ADS2248_REG_MUX0);
		reg_val=reg_val;
		*/
		SPI_transmit(ADS2_SPI,ADS1248_CMD_RESET);
		
		Ads_Delay(100);
		
		ADS_Write_Reg(ADSx,ADS1248_REG_MUX1,0x30); 
		ADS_Write_Reg(ADSx,ADS1248_REG_VBIAS,0x00);
		ADS_Write_Reg(ADSx,ADS1248_REG_IDAC1,0x89);
		ADS_Write_Reg(ADSx,ADS1248_REG_IDAC0,0x0A);
		ADS_Write_Reg(ADSx,ADS1248_REG_SYS0,0x32);
		
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_MUX1);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_VBIAS);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_IDAC1);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_IDAC0);
		reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_SYS0);
		reg_val=reg_val;
		
		SPI_Soft_CS_Disable(ADS2_SPI,ADS2_CS);	//CS不使能
#endif
	}

}

#define  pt1000_table0_Temp_Value   -20.0f
#define  pt1000_table_Max_Temp_Value   100.0f

float ADS1248_ResToTemp(float resistance)
{
	unsigned short low = 0;
	unsigned short mid = sizeof(pt1000_table) / sizeof(pt1000_table[0]) / 2;
	unsigned short high = sizeof(pt1000_table) / sizeof(pt1000_table[0]) - 1;
	unsigned short pt1000_table_Num = high;
	
	if((resistance < pt1000_table[0]) || (resistance > pt1000_table[high]))//PT1000?????
	{
	//		return 100;//PT1000?????,????100,????
		return 0xFF; // ??,??????
	}
	while(high >= low)
	{
		mid = (high + low) / 2;
		if(resistance==pt1000_table[pt1000_table_Num])	//?????pt1000_table???(100?)
		{
		  return pt1000_table_Max_Temp_Value;
		}
		if(resistance >= pt1000_table[mid])
		{
			
			if(resistance < pt1000_table[mid + 1])//||(resistance==pt1000_table[pt1000_table_Num]))
			{		
				return (pt1000_table0_Temp_Value+0.10*mid + (float)0.10*(resistance - pt1000_table[mid]) / ((pt1000_table[mid + 1]) - pt1000_table[mid]));
			}
			else
			{
					low = mid + 1;
			}
		}
		else if(resistance < pt1000_table[mid])
		{
			high = mid - 1;
		}
	}

	return 0xFF; // ????,??????
}





#define  RREF_Value1 10000//2000 //??????2K
#define  RREF_Value2 10000//2000 //??????2K
#define  RADIO1	  1.0391//
#define  RADIO2	  1.049//1.0348//1.0256//

float Ads_Read_Temp(unsigned char ADSx,unsigned char Channel)  //
{
	unsigned char ADS1248_results1,ADS1248_results2,ADS1248_results3;
	unsigned int Ads1248_Vol; 
	float ADS1248_Sample_Vol;
	float ADS1248_PGA=8.0; //ADS1248 PGA??
	//unsigned char reg_val;
	
	if(ADSx==1)
	{
#if(ADS1_ENABLE==1)	
		ADS1_START_H;
		SPI_Soft_CS_Enable(ADS1_SPI,ADS1_CS);	//CS使能
		
		switch(Channel){
			case 1:
				GPIO_ResetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_ResetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x3E); 
				Ads_Delay(10);
				break;
			case 2:
				GPIO_SetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_ResetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x2C); 
				Ads_Delay(10);
				break;
			case 3:
				GPIO_ResetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_SetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x08); 
				Ads_Delay(10);
				break;
			case 4:
				GPIO_SetBits(ADS1_SELECT0_PORT, ADS1_SELECT0_PIN);
				GPIO_SetBits(ADS1_SELECT1_PORT, ADS1_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x1A); 
				Ads_Delay(10);
				break;
			default:
				break;
		}
		Ads_Delay(100);
		//reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_MUX0);
		
		if(GPIO_ReadInputDataBit(ADS1_DRDY_PORT, ADS1_DRDY_PIN)!=0)
			return 0xff;
		
		SPI_transmit(ADS1_SPI,ADS1248_CMD_RDATA);
		
		ADS1248_results1=SPI_transmit(ADS1_SPI,ADS1248_CMD_NOP);
		ADS1248_results2=SPI_transmit(ADS1_SPI,ADS1248_CMD_NOP);
		ADS1248_results3=SPI_transmit(ADS1_SPI,ADS1248_CMD_NOP);
		SPI_transmit(ADS1_SPI,ADS1248_CMD_NOP);

		
		Ads1248_Vol=ADS1248_results1;
		Ads1248_Vol=Ads1248_Vol<<8;
		Ads1248_Vol|=ADS1248_results2;
		Ads1248_Vol=Ads1248_Vol<<8;
		Ads1248_Vol|=ADS1248_results3;	
					
		ADS1248_Sample_Vol=Ads1248_Vol;
		ADS1248_Sample_Vol/=ADS1248_PGA;

		ADS1248_Sample_Vol=ADS1248_Sample_Vol/0x7FFFFF * RREF_Value1*2; //ADS1248???????
			
		ADS1248_Sample_Vol=(float)(ADS1248_Sample_Vol*(float)RADIO1);
		//???????,??D_OUT??
		SPI_transmit(ADS1_SPI,ADS1248_CMD_NOP);	
		
		SPI_Soft_CS_Disable(ADS1_SPI,ADS1_CS);	//CS不使能
		
		return ADS1248_ResToTemp(ADS1248_Sample_Vol);
#endif
	}else if(ADSx==2)
	{
#if(ADS2_ENABLE==1)	
		ADS2_START_H;
		SPI_Soft_CS_Enable(ADS2_SPI,ADS2_CS);	//CS使能
		
		switch(Channel){
			case 1:
				GPIO_ResetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_ResetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x3E); 
				Ads_Delay(10);
				break;
			case 2:
				GPIO_SetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_ResetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x2C); 
				Ads_Delay(10);
				break;
			case 3:
				GPIO_ResetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_SetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x08); 
				Ads_Delay(10);
				break;
			case 4:
				GPIO_SetBits(ADS2_SELECT0_PORT, ADS2_SELECT0_PIN);
				GPIO_SetBits(ADS2_SELECT1_PORT, ADS2_SELECT1_PIN);
				Ads_Delay(10);
				ADS_Write_Reg(ADSx,ADS1248_REG_MUX0,0x1A); 
				Ads_Delay(10);
				break;
			default:
				break;
		}
		Ads_Delay(100);
		//reg_val = ADS_Read_Reg(ADSx,ADS1248_REG_MUX0);
		
		if(GPIO_ReadInputDataBit(ADS2_DRDY_PORT, ADS2_DRDY_PIN)!=0)
			return 0xff;
		
		SPI_transmit(ADS2_SPI,ADS1248_CMD_RDATA);
		
		ADS1248_results1=SPI_transmit(ADS2_SPI,ADS1248_CMD_NOP);
		ADS1248_results2=SPI_transmit(ADS2_SPI,ADS1248_CMD_NOP);
		ADS1248_results3=SPI_transmit(ADS2_SPI,ADS1248_CMD_NOP);
		SPI_transmit(ADS2_SPI,ADS1248_CMD_NOP);

		
		Ads1248_Vol=ADS1248_results1;
		Ads1248_Vol=Ads1248_Vol<<8;
		Ads1248_Vol|=ADS1248_results2;
		Ads1248_Vol=Ads1248_Vol<<8;
		Ads1248_Vol|=ADS1248_results3;	
					
		ADS1248_Sample_Vol=Ads1248_Vol;
		ADS1248_Sample_Vol/=ADS1248_PGA;

		ADS1248_Sample_Vol=ADS1248_Sample_Vol/0x7FFFFF * RREF_Value2*2; //ADS1248???????
		ADS1248_Sample_Vol=(float)(ADS1248_Sample_Vol*(float)RADIO2);

		SPI_transmit(ADS2_SPI,ADS1248_CMD_NOP);	
		
		SPI_Soft_CS_Disable(ADS2_SPI,ADS2_CS);	//CS不使能
		
		return ADS1248_ResToTemp(ADS1248_Sample_Vol);
#endif
	}
	return 0xff;
}



/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
